<?xml version="1.0" encoding="UTF-8"?>
<thing:thing-descriptions bindingId="thekeys"
                          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                          xmlns:thing="https://openhab.org/schemas/thing-description/v1.0.0"
                          xsi:schemaLocation="https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd">

    <bridge-type id="gateway">
        <label>TheKeys Gateway</label>
        <description>Gateway controlling a smart lock</description>

        <channels>
            <channel id="version" typeId="version"/>
            <channel id="status" typeId="gw_status"/>
        </channels>

        <properties>
            <property name="version" />
        </properties>

        <config-description>
            <parameter name="hostname" type="text" required="true">
                <context>hostname</context>
                <label>Hostname</label>
                <description>Hostname or IP address of the gateway</description>
            </parameter>
            <parameter name="code" type="text" required="true">
                <context>code</context>
                <label>Code</label>
                <description>Code to access the gateway</description>
            </parameter>
            <parameter name="refreshInterval" type="integer" min="1" unit="s" required="true">
                <label>Refresh Interval</label>
                <description>The refresh interval in seconds which is used to poll the gateway</description>
                <default>30</default>
            </parameter>
        </config-description>
    </bridge-type>

    <thing-type id="smartlock">
        <supported-bridge-type-refs>
            <bridge-type-ref id="gateway"/>
        </supported-bridge-type-refs>

        <label>TheKeys Smart Lock</label>
        <description>A smart lock thing controlling from the gateway</description>
        
        <channels>
            <channel id="status" typeId="lock_status"/>
            <channel id="batteryLevel" typeId="system.battery-level"/>
            <channel id="lowBattery" typeId="system.low-battery"/>
            <channel id="rssi" typeId="rssi"/>
            <channel id="position" typeId="position"/>
            <channel id="version" typeId="version"/>
            <channel id="lastSync" typeId="lastSync"/>
            <channel id="lock" typeId="smartlockLock"/>
        </channels>

        <properties>
            <property name="version" />
        </properties>

        <config-description>
            <parameter name="lockId" type="integer" required="true">
                <label>Lock id</label>
                <description>The identifier of the smart lock</description>
            </parameter>
        </config-description>
    </thing-type>

    <channel-type id="version">
        <item-type>Number</item-type>
        <label>Firmware version</label>
        <description>The firmware version</description>
        <state readOnly="true"/>
    </channel-type>

    <channel-type id="gw_status">
        <item-type>String</item-type>
        <label>Gateway status</label>
        <description>Status of the gateway</description>
        <state readOnly="true"/>
    </channel-type>

    <channel-type id="lock_status">
        <item-type>String</item-type>
        <label>Lock status</label>
        <description>Status of the smart lock</description>
        <state readOnly="true"/>
    </channel-type>

    <channel-type id="rssi">
        <item-type>Number</item-type>
        <label>Bluetooth rssi</label>
        <description>Bluetooth Received Signal Strength Indication</description>
        <state readOnly="true"/>
    </channel-type>

    <channel-type id="position">
        <item-type>Number</item-type>
        <label>Smart Lock position</label>
        <description>Position of the smart lock</description>
        <state readOnly="true"/>
    </channel-type>

    <channel-type id="lastSync">
        <item-type>DateTime</item-type>
        <label>Last sync</label>
        <description>Last sync with the lock</description>
        <state readOnly="true"/>
    </channel-type>

    <channel-type id="smartlockLock">
        <item-type>Switch</item-type>
        <label>Lock</label>
        <description>Use this channel with a Switch Item to unlock and lock the door.</description>
        <category>Door</category>
        <state>
            <options>
                <option value="ON">Unlocks the door</option>
                <option value="OFF">Locks the door</option>
            </options>
        </state>
    </channel-type>
</thing:thing-descriptions>
